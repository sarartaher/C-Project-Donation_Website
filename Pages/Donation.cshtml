@page
@model Donation_Website.Pages.DonationModel
@{
    ViewData["Title"] = "Donation";
}

<!-- Donation Form -->
<div class="container">
    <div class="card shadow p-4 mb-5">
        <h2 class="text-center text-primary mb-4">Make a Donation</h2>
        <form id="donationForm">
            <div class="mb-3">
                <label for="eventSelect" class="form-label">Select Event</label>
                <select class="form-select" id="eventSelect" required>
                    <option value="" disabled selected>Choose an event...</option>
                    @foreach (var f in Model.Fundraisers)
                    {
                        <option value="@f.FundraiserId">@f.Title</option>
                    }
                </select>
            </div>

            <div class="mb-3">
                <label for="amount" class="form-label">Donation Amount ($)</label>
                <input type="number" class="form-control" id="amount" placeholder="Enter amount" required>
            </div>

            <button type="submit" class="btn btn-success w-100">Add to Cart</button>
        </form>
    </div>
</div>

<!-- Cart Section -->
<div class="container">
    <div class="card shadow p-4">
        <h2 class="text-center text-warning mb-4">Donation Cart</h2>
        <table class="table table-bordered text-center">
            <thead class="table-dark">
                <tr>
                    <th>Event</th>
                    <th>Amount ($)</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.CartItems)
                {
                    <tr>
                        <td>@item.FundraiserTitle</td>
                        <td>@item.Amount</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<!-- Add to Cart Script -->
<script>
    document.getElementById("donationForm").addEventListener("submit", function(e){
        e.preventDefault();
        const fundraiserID = parseInt(document.getElementById("eventSelect").value);
        const amount = parseFloat(document.getElementById("amount").value);

        fetch('@Url.Page("/Donation", "AddToCart")', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ FundraiserID: fundraiserID, Amount: amount })
        })
        .then(res => res.json())
        .then(data => {
            if(data.success){
                alert(data.message);
                location.reload(); // Refresh page to show updated cart
            } else {
                alert("Error: " + data.message);
            }
        })
        .catch(err => console.log(err));
    });
</script>
